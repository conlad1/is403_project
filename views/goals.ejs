<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title><%= pageTitle %> | Productivity Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
<div class="flex h-screen">
  <%- include('partials/sidebar', { current: 'goals' }) %>

  <main class="flex-1 overflow-y-auto p-8">
    <header class="mb-6">
      <h1 class="text-2xl font-semibold text-gray-900 mb-2">Focus Goals</h1>
      <p class="text-gray-600">
        Define the habits and routines that help you be most effective.
      </p>
    </header>

    <!-- Add goal button -->
    <div class="mb-4 flex justify-end">
      <button id="showGoalForm"
        class="inline-flex items-center rounded-lg bg-indigo-600 px-4 py-2 text-sm font-medium text-white hover:bg-indigo-700">
        + Add Goal
      </button>
    </div>

    <!-- Add Goal Form -->
    <section id="goalFormSection" class="hidden mb-8">
      <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
        <h2 class="text-lg font-semibold text-gray-900 mb-4">Create New Goal</h2>
        <form id="goalForm" class="space-y-4">
          <div>
            <label class="block text-sm text-gray-700 mb-1" for="goalTitle">Goal Title</label>
            <input id="goalTitle" name="title" type="text" required
              class="w-full rounded-lg border-gray-300 text-sm focus:ring-indigo-500 focus:border-indigo-500" />
          </div>
          <div>
            <label class="block text-sm text-gray-700 mb-1" for="goalDescription">Description</label>
            <textarea id="goalDescription" name="description" rows="3"
              class="w-full rounded-lg border-gray-300 text-sm focus:ring-indigo-500 focus:border-indigo-500"></textarea>
          </div>
          <div>
            <label class="block text-sm text-gray-700 mb-1" for="goalDate">Target Date</label>
            <input id="goalDate" name="targetDate" type="date"
              class="w-full rounded-lg border-gray-300 text-sm focus:ring-indigo-500 focus:border-indigo-500" />
          </div>
          <div class="flex justify-end gap-2">
            <button type="button" id="cancelGoalForm"
              class="px-4 py-2 text-sm rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50">
              Cancel
            </button>
            <button type="submit"
              class="px-4 py-2 text-sm rounded-lg bg-indigo-600 text-white hover:bg-indigo-700">
              Save Goal
            </button>
          </div>
        </form>
      </div>
    </section>

    <!-- Goals list -->
    <section>
      <h2 class="text-lg font-semibold text-gray-900 mb-4">Your current goals</h2>

      <div id="goalsList" class="space-y-4">
        <% goals.forEach(function(goal) { %>
          <div class="bg-white rounded-xl p-5 shadow-sm border border-gray-200 flex flex-col gap-3"
               data-goal-id="<%= goal.id %>">
            <div class="flex items-start justify-between gap-4">
              <div>
                <h3 class="text-sm font-semibold text-gray-900"><%= goal.title %></h3>
                <p class="text-sm text-gray-600 mt-1"><%= goal.description %></p>
                <% if (goal.targetDate) { %>
                  <p class="text-xs text-gray-400 mt-1">Target: <%= goal.targetDate %></p>
                <% } %>
              </div>
              <button class="text-xs px-2 py-1 rounded-full border text-gray-500 hover:bg-gray-50 toggle-complete-btn">
                <%= goal.completed ? 'Completed' : 'Mark complete' %>
              </button>
            </div>

            <div class="mt-2">
              <div class="flex justify-between text-xs text-gray-500 mb-1">
                <span>Progress</span>
                <span><span class="goal-progress-value"><%= goal.progress %></span>%</span>
              </div>
              <div class="w-full h-2 rounded-full bg-gray-100 overflow-hidden">
                <div class="h-2 rounded-full bg-indigo-500" style="width: <%= goal.progress %>%"></div>
              </div>
            </div>

            <div class="flex justify-end">
              <button class="text-xs text-red-500 hover:text-red-600 delete-goal-btn">
                Delete
              </button>
            </div>
          </div>
        <% }); %>
      </div>
    </section>
  </main>
</div>

<script src="/js/goals.js"></script>
</body>
</html>